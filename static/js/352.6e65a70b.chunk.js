"use strict";(self.webpackChunkhk_independent_bus_eta=self.webpackChunkhk_independent_bus_eta||[]).push([[352],{7352:function(e,t,n){n.r(t);var o=n(4942),c=n(1413),r=n(7313),a=n(5465),i=n(9024),s=n(705),l=n(1190),u=n(1071),g=n(7248),d=n.n(g),p=n(6431),f=n(7829),h=n(8564),k=n(4511),b=n(7440),m=n(7308),x=n(5823),C=n(6417),v=function(){var e=(0,r.useContext)(b.Z),t=e.geolocation;return"granted"!==e.geoPermission?null:(0,C.jsx)(a.C,{center:(0,x.bf)(t),radius:25})},A=function(e){var t=e.onClick;return(0,C.jsx)("div",{className:"leaflet-bottom leaflet-right",children:(0,C.jsx)(y,{className:"".concat(z.centerControlContainer," leaflet-control leaflet-bar"),onClick:t,children:(0,C.jsx)(m.Z,{className:z.centerControl})})})};t.default=function(e){var t=e.stops,n=e.stopIdx,o=e.onMarkerClick,a=(0,r.useContext)(b.Z),g=a.geolocation,p=a.geoPermission,f=a.updateGeoPermission,h=a.colorMode,m=(0,k.$)().i18n,w=(0,r.useRef)({initialCenter:t[n]?t[n].location:(0,x.bf)(),currentStopCenter:t[n]?t[n].location:(0,x.bf)(),center:t[n]?t[n].location:(0,x.bf)(),isFollow:!1,stops:t,stopIdx:n});(0,r.useEffect)((function(){var e,o;e=w.current.stops===t&&w.current.stopIdx===n&&w.current.isFollow,o=w.current.stops===t&&w.current.stopIdx===n&&e?g:t[n]?t[n].location:(0,x.bf)();var r,a,i=w.current.center;i===o||(0,x.pB)(o,i)||(w.current.stops!==t?null===(r=w.current.map)||void 0===r||r.setView(o):null===(a=w.current.map)||void 0===a||a.flyTo(o));w.current=(0,c.Z)((0,c.Z)({},w.current),{},{center:o,currentStopCenter:t[n]?t[n].location:(0,x.bf)(),stops:t,stopIdx:n,isFollow:e})}),[t,n,g]);var y=(0,r.useCallback)((function(e){console.log("got map",e),w.current=(0,c.Z)((0,c.Z)({},w.current),{},{map:e});var t=function(){w.current=(0,c.Z)((0,c.Z)({},w.current),{},{center:w.current.currentStopCenter,isFollow:!1})};e.on({dragend:t,dragstart:t}),"prerendering"===navigator.userAgent?e.setView(w.current.center,11):e.setView(w.current.center),console.log("try invalidateSize"),e.invalidateSize()}),[]),J=(0,r.useCallback)((function(){console.log("map is ready")}),[]),N=(0,r.useCallback)((function(){var e;"granted"===p?(null===(e=w.current.map)||void 0===e||e.flyTo(g),w.current=(0,c.Z)((0,c.Z)({},w.current),{},{center:g,isFollow:!0})):"denied"!==p&&(w.current=(0,c.Z)((0,c.Z)({},w.current),{},{isFollow:!0}),f("opening"))}),[p,g,f]),B=(0,r.useMemo)((function(){return t.map((function(e,t){return(0,C.jsx)(i.J,{position:e.location,icon:Z({active:t===n,passed:t<n}),alt:"".concat(t,". ").concat(e.name[m.language]),eventHandlers:{click:function(e){o(t,e)}}},"".concat(e.location.lng,"-").concat(e.location.lat,"-").concat(t))}))}),[m.language,o,n,t]),E=(0,r.useMemo)((function(){return t.reduce((function(e,t,n,o){if(0===n)return e;var c=o[n-1];return void 0===c?(console.log("wat?",o,n),e):(e.push((0,C.jsx)(s.a,{positions:[M(c.location),M(t.location)],color:"#FF9090"},"".concat(t.location.lng,"-").concat(t.location.lat,"-line-").concat(n))),e)}),[])}),[t]);return(0,C.jsx)(j,{id:"route-map",className:z.mapContainerBox,children:(0,C.jsxs)(l.h,{center:w.current.initialCenter,zoom:16,scrollWheelZoom:!1,className:z.mapContainer,whenCreated:y,whenReady:J,children:[(0,C.jsx)(u.I,{crossOrigin:"anonymous",detectRetina:!0,maxZoom:d().Browser.retina?20:19,maxNativeZoom:18,keepBuffer:10,updateWhenIdle:!1,attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"light"===h?"https://cartodb-basemaps-a.global.ssl.fastly.net/rastertiles/voyager/{z}/{x}/{y}{r}.png":"https://cartodb-basemaps-a.global.ssl.fastly.net/light_all/{z}/{x}/{y}{r}.png"}),B,E,(0,C.jsx)(v,{}),(0,C.jsx)(A,{onClick:N})]})})};var M=function(e){return[e.lat,e.lng]},Z=function(e){var t=e.active,n=e.passed;return d().divIcon({iconSize:[25,41],iconAnchor:[12.5,41],className:"".concat(z.marker," ").concat(t?z.active:""," ").concat(n?z.passed:"")})},w="routeMap",z={mapContainerBox:"".concat(w,"-mapContainerBox"),mapContainer:"".concat(w,"-mapContainer"),centerControlContainer:"".concat(w,"-centerControlContainer"),centerControl:"".concat(w,"-centerControl"),marker:"".concat(w,"-marker"),active:"".concat(w,"-active"),passed:"".concat(w,"-passed")},j=(0,h.ZP)(f.Z)((function(e){var t,n=e.theme;return t={},(0,o.Z)(t,"&.".concat(z.mapContainerBox),{height:"30vh",filter:"dark"===n.palette.mode?"brightness(0.8)":"none"}),(0,o.Z)(t,"& .".concat(z.mapContainer),{height:"30vh"}),(0,o.Z)(t,"& .".concat(z.marker),{width:"25px",height:"41px",zIndex:618,outline:"none",filter:"hue-rotate(130deg)",backgroundImage:"url(".concat(p,")"),backgroundSize:"cover"}),(0,o.Z)(t,"& .".concat(z.active),{animation:"blinker 2s linear infinite"}),(0,o.Z)(t,"& .".concat(z.passed),{filter:"grayscale(100%)"}),t})),y=(0,h.ZP)("div")((function(e){var t;e.theme;return t={},(0,o.Z)(t,"& .".concat(z.centerControl),{padding:"5px",color:"black"}),(0,o.Z)(t,"&.".concat(z.centerControlContainer),{background:"white",height:"28px",marginBottom:"20px !important",marginRight:"5px !important"}),t}))},6431:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABSCAMAAAAhFXfZAAAC91BMVEVMaXEzeak2f7I4g7g3g7cua5gzeKg8hJo3grY4g7c3grU0gLI2frE0daAubJc2gbQwd6QzeKk2gLMtd5sxdKIua5g1frA2f7IydaM0e6w2fq41fK01eqo3grgubJgta5cxdKI1f7AydaQydaMxc6EubJgvbJkwcZ4ubZkwcJwubZgubJcydqUydKIxapgubJctbJcubZcubJcvbJYubJcvbZkubJctbJctbZcubJg2f7AubJcrbZcubJcubJcua5g3grY0fq8ubJcubJdEkdEwhsw6i88vhswuhcsuhMtBjMgthMsrg8srgss6is8qgcs8i9A9iMYtg8spgcoogMo7hcMngMonf8olfso4gr8kfck5iM8jfMk4iM8he8k1fro7itAgesk2hs8eecgzfLcofssdeMg0hc4cd8g2hcsxeLQbdsgZdcgxeLImfcszhM0vda4xgckzhM4xg84wf8Yxgs4udKsvfcQucqhUndROmdM1fK0wcZ8vb5w0eqpQm9MzeKhXoNVcpdYydKNWn9VZotVKltJFjsIwcJ1Rms9OlslLmtH///8+kc9epdYzd6dbo9VHkMM2f7FHmNBClM8ydqVcpNY9hro3gLM9hLczealQmcw3fa46f7A8gLMxc6I3eagyc6FIldJMl9JSnNRSntNNl9JPnNJFi75UnM9ZodVKksg8kM45jc09e6ZHltFBk883gbRBh7pDk9EwcaBzn784g7dKkcY2i81Om9M7j85Llc81is09g7Q4grY/j9A0eqxKmdFFltBEjcXf6fFImdBCiLxJl9FGlNFBi78yiMxVndEvbpo6js74+vx+psPP3+o/ks5HkcpGmNCjwdZCkNDM3ehYoNJEls+lxNkxh8xHks0+jdC1zd5Lg6r+/v/H2ufz9/o3jM3t8/edvdM/k89Th61OiLBSjbZklbaTt9BfptdjmL1AicBHj8hGk9FAgK1dkLNTjLRekrdClc/k7fM0icy0y9tgp9c4jc2NtM9Dlc8zicxeXZn3AAAAQ3RSTlMAHDdTb4yPA+LtnEQmC4L2EmHqB7XA0d0sr478x4/Yd5i1zOfyPkf1sLVq4Nh3FvjxopQ2/STNuFzUwFIwxKaejILpIBEV9wAABhVJREFUeF6s1NdyFEcY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"}}]);