"use strict";(self.webpackChunkhk_independent_bus_eta=self.webpackChunkhk_independent_bus_eta||[]).push([[890],{3310:function(e,n,t){var o=t(7313),a=t(5281),r=t(1113),i=t(4511),c=t(7440),s=t(9878),u=t(6417);n.Z=function(e){var n=e.routeId,t=e.seq,l=e.containerClass,d=void 0===l?"":l,p=e.showStopName,m=void 0!==p&&p,f=(0,i.$)(),x=f.t,g=f.i18n,h=(0,o.useContext)(c.Z),Z=h.db,b=Z.routeList,v=Z.stopList,j=h.etaFormat,C=(0,s.e)("".concat(n,"/").concat(t));if(null==C)return(0,u.jsx)("div",{className:d,children:(0,u.jsx)(a.Z,{size:20,style:{}})});var y=function(e){if(!e)return"";var n=Math.round((new Date(e).getTime()-(new Date).getTime())/60/1e3);return"exact"===j&&Number.isInteger(n)?e.substr(11,5):n<1?"- "+x("\u5206\u9418"):Number.isInteger(n)?n+" "+x("\u5206\u9418"):void 0},k=Object.values(b[n].stops)[0][t];return(0,u.jsxs)("div",{className:d,children:[m?(0,u.jsx)(r.Z,{variant:"caption",children:v[k].name[g.language]}):null,0===C.length?x("\u672a\u6709\u73ed\u6b21\u8cc7\u6599"):C.map((function(e,n){return(0,u.jsxs)(r.Z,{variant:"subtitle1",children:[y(e.eta)," -"," ",e.remark[g.language]?e.remark[g.language]:""," ",x(e.co)]},"route-".concat(n))}))]})}},7890:function(e,n,t){t.r(n),t.d(n,{default:function(){return ae}});var o=t(4942),a=t(9439),r=t(7313),i=t(3830),c=t(7912),s=t(1413),u=t(1113),l=t(7131),d=t(6345),p=t(7829),m=t(575),f=t(8492),x=t(1872),g=t(2576),h=t(8816),Z=t(8941),b=t(8564),v=t(7440),j=t(4511),C=t(5823),y=t(3310),k=t(6845),w=t(6417),E=(0,c.ZP)((function(){return Promise.all([t.e(604),t.e(4)]).then(t.bind(t,4004))})),P=function(e){var n=e.routeId,t=e.stopIdx,o=e.expanded,i=e.routeListEntry,c=e.stopListExtracted,p=e.handleChange,m=n,f=(0,r.useContext)(v.Z),x=f.savedEtas,b=f.updateSavedEtas,P=f.energyMode,S=(0,r.useState)(!1),M=(0,a.Z)(S,2),F=M[0],L=M[1],z=(0,r.useState)(null),B=(0,a.Z)(z,2),q=B[0],O=B[1],_=i.route,$=i.dest,A=i.fares,H=i.faresHoliday,U=(0,j.$)(),W=U.t,V=U.i18n,X=(0,r.useRef)([]);(0,r.useEffect)((function(){if(o&&X.current[t]){var e=setTimeout((function(){var e;null===(e=X.current[t])||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center"})}),50);return function(){clearTimeout(e)}}}),[o,t]);var Y=(0,r.useMemo)((function(){return c.map((function(e,n){return(0,w.jsxs)(D,{id:"stop-".concat(n),expanded:t===n&&o,onChange:function(e,t){p(n,t)},TransitionProps:{unmountOnExit:!0},ref:function(e){e instanceof HTMLElement&&(X.current[n]=e,t===n&&e.scrollIntoView({behavior:"smooth",block:"nearest"}))},classes:{root:I.accordionRoot,expanded:I.accordionExpanded},children:[(0,w.jsxs)(R,{classes:{root:I.accordionSummaryRoot,content:I.accordionSummaryContent,expanded:I.accordionSummaryExpanded},children:[(0,w.jsxs)(u.Z,{component:"h3",variant:"body1",children:[n+1,". ",(0,C.iF)(e.name[V.language])]}),(0,w.jsxs)(u.Z,{variant:"caption",children:[A&&A[n]?W("\u8eca\u8cbb")+": $"+A[n]:"",H&&H[n]?"\u3000\u3000\u3000\u3000"+W("\u5047\u65e5\u8eca\u8cbb")+": $"+H[n]:""]})]}),(0,w.jsxs)(T,{classes:{root:I.accordionDetailsRoot},children:[(0,w.jsx)(y.Z,{containerClass:I.accordionTimeReport,routeId:"".concat(m.toUpperCase()),seq:n}),(0,w.jsxs)("div",{style:{display:"flex"},children:[(0,w.jsx)(l.Z,{"aria-label":"direction",onClick:function(){var n=e.location,t=n.lat,o=n.lng;window.open("https://www.google.com/maps/dir/?api=1&destination=".concat(t,",").concat(o,"&travelmode=walking"))},style:{background:"transparent"},size:"large",children:(0,w.jsx)(g.Z,{})}),(0,w.jsx)(l.Z,{"aria-label":"share",onClick:function(t){O({id:m,route:_,dest:$,idx:n,setIsCopied:L,stop:e,event:t})},style:{backgroundColor:"transparent"},size:"large",children:(0,w.jsx)(k.Z,{})}),(0,w.jsx)(l.Z,{"aria-label":"favourite",onClick:function(){return b("".concat(m.toUpperCase(),"/").concat(n))},style:{backgroundColor:"transparent"},size:"large",children:x.includes("".concat(m.toUpperCase(),"/").concat(n))?(0,w.jsx)(h.Z,{}):(0,w.jsx)(Z.Z,{})})]})]})]},"stop-"+n)}))}),[$,o,A,H,p,V.language,m,_,x,O,t,c,W,b]);return(0,w.jsxs)(N,{className:P?I.boxContainerEnergy:I.boxContainer,children:[Y,q&&(0,w.jsx)(E,(0,s.Z)({},q)),(0,w.jsx)(d.Z,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:F,autoHideDuration:1500,onClose:function(){L(!1)},message:W("\u5df2\u8907\u88fd\u5230\u526a\u8cbc\u7c3f")})]})},S="stopAccordions",I={boxContainer:"".concat(S,"-boxContainer"),boxContainerEnergy:"".concat(S,"-boxContainerEnergy"),accordionRoot:"".concat(S,"-accordion-root"),accordionExpanded:"".concat(S,"-accordion-expanded"),accordionSummaryRoot:"".concat(S,"-summary-root"),accordionSummaryContent:"".concat(S,"-summary-content"),accordionSummaryExpanded:"".concat(S,"-summary-expanded"),accordionDetailsRoot:"".concat(S,"-details-root"),accordionTimeReport:"".concat(S,"-accordionTimeReport")},N=(0,b.ZP)(p.Z)((function(e){var n;e.theme;return n={},(0,o.Z)(n,"&.".concat(I.boxContainer),{overflowY:"scroll"}),(0,o.Z)(n,"&.".concat(I.boxContainerEnergy),{overflowY:"scroll"}),n})),D=(0,b.ZP)(m.Z)((function(e){e.theme;return(0,o.Z)({},"&.".concat(I.accordionRoot),(0,o.Z)({border:"1px solid rgba(0, 0, 0, .125)",boxShadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"}},"&.".concat(I.accordionExpanded),{margin:"auto"}))})),R=(0,b.ZP)(f.Z)((function(e){var n,t=e.theme;return(0,o.Z)({},"&.".concat(I.accordionSummaryRoot),(n={backgroundColor:"dark"===t.palette.mode?t.palette.background.default:"rgba(0, 0, 0, .03)",borderBottom:"1px solid rgba(0, 0, 0, .125)",marginBottom:-1,minHeight:44},(0,o.Z)(n,"&.".concat(I.accordionSummaryExpanded),{minHeight:44}),(0,o.Z)(n,"& .".concat(I.accordionSummaryContent),(0,o.Z)({margin:"8px 0",flexDirection:"column"},"&.".concat(I.accordionSummaryExpanded),{margin:"8px 0"})),n))})),T=(0,b.ZP)(x.Z)((function(e){var n,t=e.theme;return n={},(0,o.Z)(n,"&.".concat(I.accordionDetailsRoot),{padding:t.spacing(2),paddingTop:t.spacing(1),paddingBottom:t.spacing(1),justifyContent:"space-between",display:"flex"}),(0,o.Z)(n,"& .".concat(I.accordionTimeReport),{flex:1}),n})),M=t(3604),F=t(6467),L=t(8310),z=t(6149),B=t(1660),q="stopDialog",O={root:"".concat(q,"-root"),title:"".concat(q,"-title")},_=(0,b.ZP)(z.Z)((function(e){var n,t=e.theme;return n={},(0,o.Z)(n,"&.".concat(O.root),{"& .MuiPaper-root":{width:"100%",marginTop:"90px",height:"calc(100vh - 100px)"}}),(0,o.Z)(n,"& .".concat(O.title),{backgroundColor:"dark"===t.palette.mode?t.palette.background.default:t.palette.primary.main,color:"dark"===t.palette.mode?t.palette.primary.main:t.palette.text.primary}),n})),$=function(e){var n=e.open,t=e.stops,o=e.handleClose,i=(0,r.useContext)(v.Z).db,c=i.routeList,s=i.stopList,u=(0,j.$)().i18n,l=(0,r.useState)([]),d=(0,a.Z)(l,2),p=d[0],m=d[1];return(0,r.useEffect)((function(){if(void 0!==t){var e=[];Object.entries(c).forEach((function(n){var o=(0,a.Z)(n,2),r=o[0],i=o[1];t.some((function(n){var t=(0,a.Z)(n,2),o=t[0],c=t[1];return!(!i.stops[o]||!i.stops[o].includes(c))&&(e.push(r+"/"+i.stops[o].indexOf(c)),!0)}))})),m(e)}else m([])}),[t]),(0,w.jsxs)(_,{open:n,onClose:o,className:O.root,children:[(0,w.jsx)(M.Z,{className:O.title,children:s[t[0][1]].name[u.language]}),(0,w.jsx)(F.Z,{children:(0,w.jsx)(L.Z,{children:p.map((function(e){return(0,w.jsx)(B.Z,{routeId:e},e)}))})})]})},A=t(2295),H=t(4313),U=t(9099),W=t(219),V=t(7794),X=t(527),Y=t(3947),G={31:"\u661f\u671f\u4e00\u81f3\u4e94",287:"\u661f\u671f\u4e00\u81f3\u4e94",415:"\u661f\u671f\u4e00\u81f3\u4e94",63:"\u661f\u671f\u4e00\u81f3\u516d",319:"\u661f\u671f\u4e00\u81f3\u516d",447:"\u661f\u671f\u4e00\u81f3\u516d",416:"\u661f\u671f\u516d\u81f3\u65e5",480:"\u661f\u671f\u516d\u81f3\u65e5",266:"\u661f\u671f\u4e8c\u81f3\u56db",271:"\u661f\u671f\u4e00\u81f3\u56db",272:"\u661f\u671f\u4e94",288:"\u661f\u671f\u516d",320:"\u661f\u671f\u65e5\u53ca\u516c\u773e\u5047\u671f",448:"\u661f\u671f\u65e5\u53ca\u516c\u773e\u5047\u671f",511:"\u6240\u6709\u65e5\u5b50"},J=function(e){var n=e.freq,t=e.jt,o=e.open,i=e.onClose,c=(0,j.$)().t,s=(0,r.useMemo)((function(){return Object.entries(n).map((function(e){var n=(0,a.Z)(e,2),t=n[0],o=n[1];return(0,w.jsxs)(X.ZP,{className:Q.entries,children:[(0,w.jsx)(u.Z,{variant:"subtitle1",children:c(G[t])}),Object.entries(o).sort((function(e,n){return e[0]<n[0]?-1:1})).map((function(e){var n=(0,a.Z)(e,2),o=n[0],r=n[1];return(0,w.jsxs)("div",{className:Q.freqContainer,children:[(0,w.jsxs)(u.Z,{variant:"caption",children:[o," ",r?"-".concat(r[0]):""]}),r?(0,w.jsxs)(u.Z,{variant:"caption",children:[parseInt(r[1],10)/60,c("\u5206\u9418")]}):(0,w.jsx)(w.Fragment,{})]},"".concat(t,"-").concat(o))}))]},"".concat(t))}))}),[n,c]),l=(0,r.useMemo)((function(){return{onClose:function(){i()}}}),[i]),d=(0,r.useMemo)((function(){return{className:"timetable-drawer"}}),[]);return(0,w.jsxs)(ee,{open:o,ModalProps:l,PaperProps:d,anchor:"right",children:[t?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(X.ZP,{className:Q.entries,children:(0,w.jsxs)("div",{className:Q.jtContainer,children:[(0,w.jsx)(u.Z,{variant:"subtitle1",children:c("\u8eca\u7a0b")}),(0,w.jsxs)(u.Z,{variant:"subtitle1",children:[t,c("\u5206\u9418")]})]})}),(0,w.jsx)(H.Z,{className:Q.divider})]}):null,(0,w.jsx)(L.Z,{children:s})]})},K="timetable",Q={drawer:"".concat(K,"-drawer"),entries:"".concat(K,"-entries"),jtContainer:"".concat(K,"-jtContainer"),divider:"".concat(K,"-divider"),freqContainer:"".concat(K,"-freqContainer")},ee=(0,b.ZP)(Y.ZP)((function(e){var n,t=e.theme;return n={},(0,o.Z)(n,"& .".concat(Q.drawer),{height:"100vh",width:"80%",maxWidth:"320px",paddingTop:"56px",paddingLeft:"20px",backgroundColor:"dark"===t.palette.mode?t.palette.background.default:t.palette.primary.main,backgroundImage:"none"}),(0,o.Z)(n,"& .".concat(Q.jtContainer),{display:"flex",justifyContent:"space-between",width:"80%"}),(0,o.Z)(n,"& .".concat(Q.divider),{width:"80%"}),(0,o.Z)(n,"& .".concat(Q.entries),{flexDirection:"column",alignItems:"flex-start"}),(0,o.Z)(n,"& .".concat(Q.freqContainer),{display:"flex",justifyContent:"space-between",width:"80%"}),n})),ne=(0,c.ZP)((function(){return Promise.all([t.e(149),t.e(352)]).then(t.bind(t,7352))})),te=function(e,n){for(var t=0;t<e.length;++t)if(e[t]in n)return n[e[t]];return[]},oe=function(e,n,t,o){for(var a=0;a<e.length;++a)if(e[a]in n)return[[e[a],n[e[a]][o]]].concat(t[n[e[a]][o]]||[])},ae=function(){var e=(0,i.UO)(),n=e.id,t=e.panel,o=(0,r.useContext)(v.Z),c=o.AppTitle,s=o.db,l=s.routeList,d=s.stopList,p=s.stopMap,m=o.updateSelectedRoute,f=o.energyMode,x=o.workbox,g=o.geoPermission,h=o.geolocation,Z=l[n.toUpperCase()],b=Z.route,y=Z.stops,k=Z.co,E=Z.orig,S=Z.dest,I=Z.nlbId,N=Z.fares,D=Z.freq,R=Z.jt,T=(0,r.useMemo)((function(){return te(k,y).map((function(e){return d[e]})).filter((function(e){return null!==e&&void 0!==e}))}),[k,d,y]),M=0;if(void 0!==t)M=parseInt(t,10);else if("granted"===g){var F=T.map((function(e,n){return[n,(0,C.Sp)(h,e.location)]})).sort((function(e,n){return e[1]-n[1]}))[0];M=F.length>0?F[0]:0}else M=0;var L=(0,r.useState)(!0),z=(0,a.Z)(L,2),B=z[0],q=z[1],O=(0,r.useState)(!1),_=(0,a.Z)(O,2),A=_[0],H=_[1],U=(0,r.useState)(!1),X=(0,a.Z)(U,2),Y=X[0],G=X[1],K=(0,r.useMemo)((function(){return oe(k,y,p,String(M))}),[k,M,p,y]),Q=(0,j.$)(),ee=Q.t,ae=Q.i18n,ue=(0,i.k6)(),le=(0,r.useCallback)((function(e,t){t&&M!==e&&ue.replace("/".concat(ae.language,"/route/").concat(n,"/").concat(e)),M!==e||t?q(t):H(!0)}),[ue,ae.language,n,M]),de=(0,r.useCallback)((function(e){M===e&&H(!0),ue.replace("/".concat(ae.language,"/route/").concat(n,"/").concat(e))}),[ue,ae.language,n,M]),pe=(0,r.useCallback)((function(){H(!1)}),[H]);return(0,r.useEffect)((function(){H(!1),document.getElementById(n).setAttribute("value",n),m(n)}),[n,m]),(0,r.useEffect)((function(){(0,C.ND)({title:b+" "+ee("\u5f80")+" "+(0,C.iF)(S[ae.language])+" - "+ee(c),description:function(){var e=N?N.filter((function(e,n,t){return t.indexOf(e)===n})).map((function(e){return"$".concat(e)})):[];return"zh"===ae.language?"\u8def\u7dda".concat(b)+"\u7531".concat(E.zh,"\u51fa\u767c\uff0c\u4ee5").concat(S.zh,"\u70ba\u7d42\u9ede\uff0c")+(e.length?"\u5206\u6bb5\u8eca\u8cbb\u70ba".concat(e.join("\u3001"),"\uff0c"):"")+"\u9014\u7d93".concat(T.map((function(e){return e.name.zh})).join("\u3001"),"\u3002"):"Route ".concat(b," ")+"is from ".concat((0,C.iF)(E.en)," to ").concat((0,C.iF)(S.en))+(e.length?", section fees are ".concat(e.join(", "),". "):". ")+"Stops: "+(0,C.iF)(T.map((function(e){return e.name.en})).join(", "))+". "}(),lang:ae.language})}),[c,S,N,ae.language,E.en,E.zh,b,T,ee]),(0,r.useEffect)((function(){if(!f){var e={type:"WARN_UP_MAP_CACHE",retinaDisplay:(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,zoomLevels:[14,15,16,17,18],stopList:te(k,y).map((function(e){return d[e]})).filter((function(e){return null!==e&&void 0!==e}))};null===x||void 0===x||x.messageSW(e)}}),[k,f,d,y,x]),(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("input",{hidden:!0,id:n}),(0,w.jsxs)(ie,{id:"route-eta-header",className:re.header,elevation:0,children:[(0,w.jsx)(W.Z,{routeNo:b,component:"h1",align:"center"}),(0,w.jsxs)(u.Z,{component:"h2",variant:"caption",align:"center",children:[ee("\u5f80")," ",(0,C.iF)(S[ae.language])," ",I?ee("\u7531")+" "+(0,C.iF)(E[ae.language]):""]}),D?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(ce,{orientation:"vertical",className:re.buttonDivider}),(0,w.jsx)(se,{variant:"text","aria-label":"open-timetable",className:re.timeTableButton,size:"small",startIcon:(0,w.jsx)(V.Z,{}),onClick:function(){return G(!0)},children:ee("\u6642\u9593\u8868")}),(0,w.jsx)(J,{freq:D,jt:R,open:Y,onClose:function(){return G(!1)}})]}):(0,w.jsx)(w.Fragment,{})]}),f?(0,w.jsx)(w.Fragment,{}):(0,w.jsx)(ne,{stops:T,stopIdx:M,onMarkerClick:de}),(0,w.jsx)(P,{routeId:n,stopIdx:M,routeListEntry:Z,stopListExtracted:T,expanded:B,handleChange:le}),(0,w.jsx)($,{open:A,stops:K,handleClose:pe})]})},re={header:"".concat("route","-header"),buttonDivider:"timetable-button-divider",timeTableButton:"timetable-button"},ie=(0,b.ZP)(A.Z)((function(e){e.theme;return(0,o.Z)({},"&.".concat(re.header),{textAlign:"center",background:"transparent",position:"relative"})})),ce=(0,b.ZP)(H.Z)((function(e){e.theme;return(0,o.Z)({},"&.".concat(re.buttonDivider),{position:"absolute",top:"0",right:"calc(64px + 2%)"})})),se=(0,b.ZP)(U.Z)((function(e){var n=e.theme;return(0,o.Z)({},"&.".concat(re.timeTableButton),{color:n.palette.getContrastText(n.palette.background.default),position:"absolute",top:"0",right:"2%",flexDirection:"column",justifyContent:"center","& > .MuiButton-label":{flexDirection:"column",justifyContent:"center"},"& > .MuiButton-startIcon":{margin:0}})}))}}]);